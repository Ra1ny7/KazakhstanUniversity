{% extends "base.html" %}
{% block title %}–°—Ä–∞–≤–Ω–µ–Ω–∏–µ{% endblock %}
{% block page_title %}–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤{% endblock %}
{% block page_sub %}–°—Ä–∞–≤–Ω–∏—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤{% endblock %}

{% block content %}
<style>
    .compare-container {
        overflow-x: auto;
        margin: 20px 0;
    }

    .compare-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 800px;
        background: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        overflow: hidden;
    }

    .compare-table thead {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .compare-table th {
        padding: 15px 10px;
        text-align: left;
        font-weight: 600;
        font-size: 14px;
        border-right: 1px solid rgba(255, 255, 255, 0.1);
    }

    .compare-table th:first-child {
        position: sticky;
        left: 0;
        z-index: 2;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-width: 200px;
    }

    .compare-table td {
        padding: 12px 10px;
        border-bottom: 1px solid #e0e0e0;
        border-right: 1px solid #e0e0e0;
        font-size: 13px;
        vertical-align: top;
    }

    .compare-table tbody tr:hover {
        background-color: #f5f5f5;
    }

    .compare-table td:first-child {
        position: sticky;
        left: 0;
        background: #fafafa;
        font-weight: 600;
        z-index: 1;
        border-right: 2px solid #ddd;
    }

    .university-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
    }

    .remove-btn {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.3s;
    }

    .remove-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .empty-state-icon {
        font-size: 64px;
        margin-bottom: 20px;
        opacity: 0.3;
    }

    .empty-state h3 {
        color: #555;
        margin-bottom: 10px;
    }

    .empty-state p {
        color: #888;
        margin-bottom: 20px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        text-decoration: none;
        display: inline-block;
        font-weight: 600;
        transition: transform 0.3s;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .field-label {
        font-weight: 600;
        color: #333;
    }

    .highlight-best {
        background-color: #e8f5e9;
        font-weight: 600;
    }

    .alert-info {
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 16px;
        margin: 20px 0;
        border-radius: 8px;
    }

    .alert-info p {
        margin: 0;
        color: #1565c0;
    }

    @media (max-width: 768px) {

        .compare-table th,
        .compare-table td {
            padding: 8px 5px;
            font-size: 12px;
        }

        .compare-table th:first-child,
        .compare-table td:first-child {
            min-width: 150px;
        }
    }
</style>

{% if universities %}
{% if universities|length == 1 %}
<div class="alert-info">
    <p>üí° –î–æ–±–∞–≤—å—Ç–µ –µ—â–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫</p>
</div>
{% endif %}

<div class="compare-container">
    <table class="compare-table">
        <thead>
            <tr>
                <th>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞</th>
                {% for u in universities %}
                <th>
                    <div class="university-header">
                        <span>{{ u.name }}</span>
                        <button class="remove-btn" onclick="removeFromCompare({{ u.id }})">‚úï</button>
                    </div>
                </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="field-label">–ì–æ—Ä–æ–¥</td>
                {% for u in universities %}
                <td>{{ u.city }}</td>
                {% endfor %}
            </tr>

            <tr>
                <td class="field-label">–ì–æ–¥ –æ—Å–Ω–æ–≤–∞–Ω–∏—è</td>
                {% for u in universities %}
                <td {% if u.founded==universities|map(attribute='founded' )|min %}class="highlight-best" {% endif %}>
                    {{ u.founded }}
                    {% if u.founded==universities|map(attribute='founded')|min %}
                    <small style="color: #4caf50;">‚úì –°–∞–º—ã–π —Å—Ç–∞—Ä—ã–π</small>
                    {% endif %}
                </td>
                {% endfor %}
            </tr>

            <tr>
                <td class="field-label">–¢–∏–ø —É—á—Ä–µ–∂–¥–µ–Ω–∏—è</td>
                {% for u in universities %}
                <td>{{ u.type }}</td>
                {% endfor %}
            </tr>

            <tr>
                <td class="field-label">–°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è</td>
                {% for u in universities %}
                <td>{{ u.tuition }}</td>
                {% endfor %}
            </tr>

            <tr>
                <td class="field-label">–£—Å–ª–æ–≤–∏—è –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è</td>
                {% for u in universities %}
                <td>{{ u.admission }}</td>
                {% endfor %}
            </tr>

            <tr>
                <td class="field-label">–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ —Å–≤—è–∑–∏</td>
                {% for u in universities %}
                <td>{{ u.international_relations }}</td>
                {% endfor %}
            </tr>

            <tr>
                <td class="field-label">–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</td>
                {% for u in universities %}
                <td>{{ u.academic_programs }}</td>
                {% endfor %}
            </tr>

            <tr>
                <td class="field-label">–£—Å–ª–æ–≤–∏—è –æ–±—É—á–µ–Ω–∏—è</td>
                {% for u in universities %}
                <td>{{ u.conditions_of_study }}</td>
                {% endfor %}
            </tr>

            <tr>
                <td class="field-label">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</td>
                {% for u in universities %}
                <td>{{ u.long_info }}</td>
                {% endfor %}
            </tr>
        </tbody>
    </table>
</div>

<div style="text-align: center; margin-top: 30px;">
    <a href="{{ url_for('universities_page') }}" class="btn-primary">
        {% if universities|length < 5 %} ‚ûï –î–æ–±–∞–≤–∏—Ç—å –µ—â–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã ({{ 5 - universities|length }} –º–µ—Å—Ç –¥–æ—Å—Ç—É–ø–Ω–æ) {%
            else %} ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–∞—Ç–∞–ª–æ–≥—É {% endif %} </a>
</div>

{% else %}
<div class="empty-state">
    <div class="empty-state-icon">üìä</div>
    <h3>–°–ø–∏—Å–æ–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø—É—Å—Ç</h3>
    <p>–í—ã –ø–æ–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–ª–∏ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è. –î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ
        —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫.</p>
    <a href="{{ url_for('universities_page') }}" class="btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</a>
</div>
{% endif %}

<script>
    function removeFromCompare(universityId) {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–∑ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è?')) {
            return;
        }

        fetch('/api/compare', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                university_id: universityId
            })
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'removed') {
                    location.reload();
                } else {
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
            });
    }
</script>
{% endblock %}